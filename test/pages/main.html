<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>main</title>
    <link href="/test/styles/main.css" type="text/css" rel="stylesheet" media="all"/>

</head>
<body>
    <div class="page">
        <h1>main</h1>
        <!--this is a comment -->
    </div>
    <div class="capture">
        <button>capture</button>
    </div>
    <div class="result"></div>


    <script src="/bower_components/jquery/dist/jquery.min.js"></script>
    <script src="/src/modifiers/error-handler.js"></script>
    <script src="/src/modifiers/modifier-clone-iframe.js"></script>
    <script src="/src/modifiers/modifier-cleaner.js"></script>
    <script src="/src/dom-to-image.js"></script>

    <script>
        domtoimage.registerModifier("clone",ModifierCloneIframe,{isSelector:"iframe"},1);
        domtoimage.registerModifier("clone",ModifierCleaner,{},100);
        //domtoimage.registerModifier("xml",StyleCleaner,{},100);

        domtoimage.registerErrorHandler(ErrorHandler);

        $(".capture button").click(function(){
            var node = $(".page").get(0);
            domtoimage.toPng(node)
                    .then(function (dataUrl) {
                        var img = new Image();
                        img.src = dataUrl;
                        $(".result").html(img);
                    })
                    .catch(function (error) {
                        console.error('oops, something went wrong!', error);
                    });
        });


        /**
         * this is an example how we can use promises to chain the clone to call one another in a chain getting the results
         * of the last clonner. not sure if this is what we want...
          */
        //        var f1 = function(val){
//            console.log("calling f1 with ",val);
//            return new Promise( function(resolve){
//                setTimeout( function(){
//
//                    resolve(val+1);
//                },10);
//            });
//        };
//
//        var arr = [f1,f1,f1,f1];
//
//        var seq = Promise.resolve(1);
//
//        arr.reduce( function(s,f){
//
//            s = s.then(f);
//            return s;
//
//        },
//        seq).then(function(res){
//            console.log("finished ",res);
//        });

    </script>



</body>
</html>